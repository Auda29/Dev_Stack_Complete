# Docker Compose - Agent Containers
# This file defines all AI agent containers for the Dev_Stack system

services:
  # Taskmaster - Plans and orchestrates tasks
  agent_taskmaster:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_taskmaster
    hostname: taskmaster
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/devops
    environment:
      - AGENT_NAME=Taskmaster
      - AGENT_ROLE=orchestration
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=openai
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_started

  # Dev1 - Core domain logic developer
  agent_dev1:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_dev1
    hostname: dev1
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/dev1
    environment:
      - AGENT_NAME=Dev1
      - AGENT_ROLE=core_development
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=anthropic
      - ANTHROPIC_MODEL=claude-3-5-sonnet-20240620
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_started

  # Dev2 - API/Integration developer
  agent_dev2:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_dev2
    hostname: dev2
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/dev2
    environment:
      - AGENT_NAME=Dev2
      - AGENT_ROLE=integration_development
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=anthropic
      - ANTHROPIC_MODEL=claude-3-5-sonnet-20240620
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_started

  # Testing - QA and test automation
  agent_testing:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_testing
    hostname: testing
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/testing
    environment:
      - AGENT_NAME=Testing
      - AGENT_ROLE=quality_assurance
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=anthropic
      - ANTHROPIC_MODEL=claude-3-5-sonnet-20240620
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_started

  # Review - Code review and quality checks
  agent_review:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_review
    hostname: review
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/review
    environment:
      - AGENT_NAME=Review
      - AGENT_ROLE=code_review
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=openai
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_started

  # DevOps - Integration, merging, CI/CD
  agent_devops:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    container_name: agent_devops
    hostname: devops
    volumes:
      - .:/repo
    working_dir: /repo/.worktrees/devops
    environment:
      - AGENT_NAME=DevOps
      - AGENT_ROLE=integration_deployment
      - PYTHONUNBUFFERED=1
      - LLM_PROVIDER=anthropic
      - ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
    command: python -u scripts/agent_listener.py
    networks:
      - devstack
    env_file:
      - .env
    restart: unless-stopped
    depends_on:
      chroma:
        condition: service_healthy

networks:
  devstack:
    driver: bridge
